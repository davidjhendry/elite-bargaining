---
title: "Elite Bargaining Analysis"
author: "David Hendry and Sunhee Park"
date: "November 11, 2021"
output:
  html_document:
    #df_print: paged
    toc: true
    toc_float: true
  pdf_document: default
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE)
#setwd()
```

# Preliminaries

Read in the data and create variables.

```{r}
library(tidyverse)
library(readxl)
library(sandwich)
library(lmtest)

# set working directory
#setwd('...')

# read in data and make all variable names lower case
eb_data <-
  read_excel('Data/PSBargainingDataset_DFF.xlsx',
             sheet = 'CombinedPS_DyadLevel') %>% rename_all(tolower)

# remove spaces and non-standard characters
names(eb_data) <- gsub(' ', '', names(eb_data))
names(eb_data) <- gsub('\\(', '', names(eb_data))
names(eb_data) <- gsub('\\)', '', names(eb_data))
names(eb_data) <- gsub('\\?', '', names(eb_data))
names(eb_data) <- gsub(',', '', names(eb_data))
names(eb_data) <- gsub('~', '', names(eb_data))

# drop some unnecessary variables that will not be used
drop_cols <- c('note_sideb1', 'note_sideb2', 'note_sideb3', 'note_sideb4',
               'note_sideb5', 'sideb6', 'ucdp_nego_detail', 'negotiations',
               'psharing', 'reader', 'r1bar', 'r1psharing', 'r2bar',
               'r2psharing', 'r3bar', 'r3psharing', 'powersharing1stcheck',
               'powersharing2ndcheck', 'powersharing3rdcheck',
               'intercodermatchpsharing', 'intercodermatchbargaining', 
               'reconciled', 'matching', 'conflictid', 'p1death', 'p2death',
               'p3death', 'p4death', 'startdate', 'startprec', 'startdate2',
               'startprec2', 'epend', 'ependdate', 'ependprec', 'gwnoa',
               'gwnoa2nd', 'gwnob', 'gwnob2nd', 'region', 'sideb5')
eb_data <- eb_data %>% select(-one_of(drop_cols))

# create variable transformations
eb_data <- eb_data %>%
  mutate(overconcession1 = dyad1_otheroffer - dyad1_myoffer,
         reldeaths90start_adjusted = replace_na(reldeaths90start, .5),
         mulrebel = case_when(noofparticipants == 2 ~ 0,
                              noofparticipants > 2 ~ 1),
         auto = if_else(polityiv < -5, 1, 0),
         dyad1_relativetroops = as.numeric(dyad1_relativetroops),
         mediation_derouen = as.numeric(mediation_derouen),
         setend = as.numeric(setend),
         location_foreign = as.numeric(location_foreign),
         accept1 = case_when(dyad1_outcomea == 0 ~ 1,
                             dyad1_outcomea == 1 ~ 0)) %>%
  mutate(overconcession1a = case_when(overconcession1 > 0 ~ 0,
                                      overconcession1 <= 0 ~ 1))
names(eb_data)
```

# Descriptive Statistics
```{r}

```

# Models

## What Explains a Generous Offer?
```{r}
model01 <- glm(overconcession1a ~ dyad1_leader + rebel +
               reldeaths90start_adjusted + mulrebel + incompatibility + mulps +
               guarantee + mediation_derouen + auto + setend +
               location_foreign + dyad1_relativetroops,
               family = binomial(link = 'logit'), data = eb_data)
model01_cl <- coeftest(model01, vcov = vcovCL, cluster = ~psbargaining)
model01_cl
```

## What Explains Offer Acceptance by Leaders?
```{r}
model02 <- glm(accept1 ~ overconcession1a + rebel +
               reldeaths90start_adjusted + mulrebel + incompatibility + mulps +
               guarantee + mediation_derouen + auto + setend +
               location_foreign + dyad1_relativetroops,
               family = binomial(link = 'logit'), data = eb_data,
               subset = (dyad1_leader == 1))
model02_cl <- coeftest(model02, vcov = vcovCL, cluster = ~psbargaining)
model02_cl
```

## What Explains Offer Acceptance by Delegates?
```{r}
model03 <- glm(accept1 ~ overconcession1a + rebel +
               reldeaths90start_adjusted + mulrebel + incompatibility + mulps +
               guarantee + mediation_derouen + auto + setend +
               location_foreign + dyad1_relativetroops,
               family = binomial(link = 'logit'), data = eb_data,
               subset = (dyad1_leader == 0))
model03_cl <- coeftest(model03, vcov = vcovCL, cluster = ~psbargaining)
model03_cl
```




Next:
* only dyads
* rebels alone
* governments alone




























